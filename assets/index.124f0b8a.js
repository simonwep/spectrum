var Q=Object.defineProperty;var $=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var P=(n,e,t)=>e in n?Q(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,A=(n,e)=>{for(var t in e||(e={}))V.call(e,t)&&P(n,t,e[t]);if($)for(var t of $(e))Y.call(e,t)&&P(n,t,e[t]);return n};var E=(n,e,t)=>(P(n,typeof e!="symbol"?e+"":e,t),t);const Z=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}};Z();try{self["workbox:window:6.5.2"]&&_()}catch{}function j(n,e){return new Promise(function(t){var i=new MessageChannel;i.port1.onmessage=function(o){t(o.data)},n.postMessage(e,[i.port2])})}function ee(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function K(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function te(n,e){var t;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(t=function(o,l){if(o){if(typeof o=="string")return K(o,l);var a=Object.prototype.toString.call(o).slice(8,-1);return a==="Object"&&o.constructor&&(a=o.constructor.name),a==="Map"||a==="Set"?Array.from(o):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?K(o,l):void 0}}(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var i=0;return function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(t=n[Symbol.iterator]()).next.bind(t)}try{self["workbox:core:6.5.2"]&&_()}catch{}var M=function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})};function T(n,e){var t=location.href;return new URL(n,t).href===new URL(e,t).href}var D=function(n,e){this.type=n,Object.assign(this,e)};function B(n,e,t){return t?e?e(n):n:(n&&n.then||(n=Promise.resolve(n)),e?n.then(e):n)}function ne(){}var ie={type:"SKIP_WAITING"};function H(n,e){if(!e)return n&&n.then?n.then(ne):Promise.resolve()}var re=function(n){var e,t;function i(c,d){var s,r;return d===void 0&&(d={}),(s=n.call(this)||this).nn={},s.tn=0,s.rn=new M,s.en=new M,s.on=new M,s.un=0,s.an=new Set,s.cn=function(){var u=s.fn,f=u.installing;s.tn>0||!T(f.scriptURL,s.sn.toString())||performance.now()>s.un+6e4?(s.vn=f,u.removeEventListener("updatefound",s.cn)):(s.hn=f,s.an.add(f),s.rn.resolve(f)),++s.tn,f.addEventListener("statechange",s.ln)},s.ln=function(u){var f=s.fn,h=u.target,g=h.state,m=h===s.vn,v={sw:h,isExternal:m,originalEvent:u};!m&&s.mn&&(v.isUpdate=!0),s.dispatchEvent(new D(g,v)),g==="installed"?s.wn=self.setTimeout(function(){g==="installed"&&f.waiting===h&&s.dispatchEvent(new D("waiting",v))},200):g==="activating"&&(clearTimeout(s.wn),m||s.en.resolve(h))},s.dn=function(u){var f=s.hn,h=f!==navigator.serviceWorker.controller;s.dispatchEvent(new D("controlling",{isExternal:h,originalEvent:u,sw:f,isUpdate:s.mn})),h||s.on.resolve(f)},s.gn=(r=function(u){var f=u.data,h=u.ports,g=u.source;return B(s.getSW(),function(){s.an.has(g)&&s.dispatchEvent(new D("message",{data:f,originalEvent:u,ports:h,sw:g}))})},function(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];try{return Promise.resolve(r.apply(this,u))}catch(h){return Promise.reject(h)}}),s.sn=c,s.nn=d,navigator.serviceWorker.addEventListener("message",s.gn),s}t=n,(e=i).prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t;var o,l,a=i.prototype;return a.register=function(c){var d=(c===void 0?{}:c).immediate,s=d!==void 0&&d;try{var r=this;return function(u,f){var h=u();return h&&h.then?h.then(f):f(h)}(function(){if(!s&&document.readyState!=="complete")return H(new Promise(function(u){return window.addEventListener("load",u)}))},function(){return r.mn=Boolean(navigator.serviceWorker.controller),r.yn=r.pn(),B(r.bn(),function(u){r.fn=u,r.yn&&(r.hn=r.yn,r.en.resolve(r.yn),r.on.resolve(r.yn),r.yn.addEventListener("statechange",r.ln,{once:!0}));var f=r.fn.waiting;return f&&T(f.scriptURL,r.sn.toString())&&(r.hn=f,Promise.resolve().then(function(){r.dispatchEvent(new D("waiting",{sw:f,wasWaitingBeforeRegister:!0}))}).then(function(){})),r.hn&&(r.rn.resolve(r.hn),r.an.add(r.hn)),r.fn.addEventListener("updatefound",r.cn),navigator.serviceWorker.addEventListener("controllerchange",r.dn),r.fn})})}catch(u){return Promise.reject(u)}},a.update=function(){try{return this.fn?H(this.fn.update()):void 0}catch(c){return Promise.reject(c)}},a.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},a.messageSW=function(c){try{return B(this.getSW(),function(d){return j(d,c)})}catch(d){return Promise.reject(d)}},a.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&j(this.fn.waiting,ie)},a.pn=function(){var c=navigator.serviceWorker.controller;return c&&T(c.scriptURL,this.sn.toString())?c:void 0},a.bn=function(){try{var c=this;return function(d,s){try{var r=d()}catch(u){return s(u)}return r&&r.then?r.then(void 0,s):r}(function(){return B(navigator.serviceWorker.register(c.sn,c.nn),function(d){return c.un=performance.now(),d})},function(d){throw d})}catch(d){return Promise.reject(d)}},o=i,(l=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&ee(o.prototype,l),i}(function(){function n(){this.Pn=new Map}var e=n.prototype;return e.addEventListener=function(t,i){this.Sn(t).add(i)},e.removeEventListener=function(t,i){this.Sn(t).delete(i)},e.dispatchEvent=function(t){t.target=this;for(var i,o=te(this.Sn(t.type));!(i=o()).done;)(0,i.value)(t)},e.Sn=function(t){return this.Pn.has(t)||this.Pn.set(t,new Set),this.Pn.get(t)},n}());function oe(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:i,onRegistered:o,onRegisterError:l}=n;let a;const c=async(d=!0)=>{};return"serviceWorker"in navigator&&(a=new re("./sw.js",{scope:"./",type:"classic"}),a.addEventListener("activated",d=>{d.isUpdate?window.location.reload():i==null||i()}),a.register({immediate:e}).then(d=>{o==null||o(d)}).catch(d=>{l==null||l(d)})),c}const W=(n,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n),se=(n,e,t)=>{let i,o,l;if(e===0)i=o=l=t;else{const a=t<.5?t*(1+e):t+e-t*e,c=2*t-a;i=W(c,a,n+1/3),o=W(c,a,n),l=W(c,a,n-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(l*255)]},ae=async(n,e)=>new Promise(t=>{const i=new FileReader;i.onloadend=()=>{const o=i.result;new AudioContext(e).decodeAudioData(o).then(t)},i.readAsArrayBuffer(n)}),ce=async n=>{const e=new Array(n.frames),t=new OfflineAudioContext(n.contextOptions),i=t.createAnalyser();Object.assign(i,n.analyzerOptions),i.smoothingTimeConstant=0,i.connect(t.destination);const o=n.buffer.duration/n.frames,l=i.frequencyBinCount;for(let c=0;c<n.frames;c++){const d=c*o;t.suspend(d).then(()=>{t.resume(),i.getByteFrequencyData(e[c]=new Uint8Array(l))})}const a=t.createBufferSource();return a.buffer=n.buffer,a.connect(i),a.start(),await t.startRendering(),e},F=270,N=300,q=new Array(256);for(let n=0;n<=255;n++){const e=q[255-n]=new Uint8ClampedArray(4),t=n/255*N,i=t>F?.5*((300-t)/(N-F)):.5;e.set(se(t/360,1,i),0),e[3]=255}const U=class{constructor(e,t){E(this,"isRendering",!1);E(this,"canvas");E(this,"audio");this.file=e,this.options=t}getSpectrum(){var e;return(e=this.canvas)!=null?e:null}getBitrate(){if(this.audio){const{duration:e,length:t}=this.audio;return t/e*8}return null}async startRender(e){var r,u,f;if(this.isRendering)return;if(!e)throw new Error("Config missing.");if((!this.audio||e&&e.audioContextOptions!==((r=this.options)==null?void 0:r.audioContextOptions))&&(this.audio=await ae(this.file,e.audioContextOptions)),this.canvas&&this.options&&(!e||e.height<=this.options.height&&e.width<=this.options.width&&e.minDecibels===this.options.minDecibels&&e.maxDecibels===this.options.maxDecibels))return;this.options=A(A({},this.options),e);let t=2;for(;t/2<e.height;)t*=2;this.isRendering=!0;const i=this.audio,o=await ce({frames:this.options.width,buffer:i,contextOptions:{numberOfChannels:i.numberOfChannels,sampleRate:i.sampleRate,length:i.length},analyzerOptions:{fftSize:t,minDecibels:(u=this.options.minDecibels)!=null?u:-120,maxDecibels:(f=this.options.maxDecibels)!=null?f:-20}}),l=o.length,a=o[0].length,c=new ImageData(l,a),d=U.COLORS;for(let h=0;h<l;h++){const g=o[h];for(let m=0;m<a;m++){const v=g[m];if(v){const x=(h+(a-m-1)*l)*4,p=d[v];c.data.set(p,x)}}}const s=this.canvas=document.createElement("canvas");s.width=l,s.height=a,s.getContext("2d",{alpha:!1}).putImageData(c,0,0),this.isRendering=!1}};let R=U;E(R,"COLORS",q);const z=(n,e)=>{let t=2;for(;;){const i=t*2+t%2;if(e/i<n)break;t=i}return[t,e/t]},le=n=>`${Math.floor(n/60)}:${String(n%60).padStart(2,"0")}`,ue=n=>{var h;const{context:e,renderer:t,config:{visuals:i,analyzer:o}}=n;e.resetTransform();const{width:l,height:a}=e.canvas,[c,d,s,r]=i.graphMargin,u=a-c-s,f=l-d-r;e.fillStyle="white",e.strokeStyle="white",e.font="12px monospace",e.strokeRect(r-.5,c-.5,f+1,u+1);{const g=l-d+10,m=c-1,v=g+i.decibelBarWidth,x=a-s+1,p=e.createLinearGradient(g,m,v,x),b=R.COLORS;for(let w=0;w<b.length;w++){const[O,C,J]=b[b.length-w-1];p.addColorStop(w/b.length,`rgb(${O}, ${C}, ${J})`)}e.fillStyle=p,e.fillRect(g,m,i.decibelBarWidth,u),e.textAlign="left",e.textBaseline="middle";const[y,k]=z(i.tickMinDistance,u),L=o.minDecibels-o.maxDecibels;for(let w=0;w<=y;w++){const O=m+w*k,C=`${Math.floor(w/y*L+o.maxDecibels)} dB`;e.fillStyle=p,e.fillRect(v,O,i.tickLength,i.tickThickness),e.fillStyle="white",e.fillText(C,v+i.tickLength+2,O+1)}}if(t!=null&&t.audio){const{sampleRate:g,duration:m,numberOfChannels:v}=t.audio;{const x=u+1,[p,b]=z(i.tickMinDistance,x),y=g/2/1e3;e.textAlign="right",e.textBaseline="middle";for(let k=0;k<=p;k++){const L=c+k*b-1,w=`${Math.floor((p-k)/p*y)} kHz`;e.fillRect(r-i.tickLength,L,i.tickLength,i.tickThickness),e.fillText(w,r-i.tickLength-2,L+1)}}{const x=f+1,[p,b]=z(i.tickMinDistance*2,x);e.textAlign="center",e.textBaseline="hanging",e.font="12px monospace";for(let y=0;y<=p;y++){const k=r+y*b-1,L=le(Math.floor(y/p*m));e.fillRect(k,c+u,i.tickThickness,i.tickLength),e.fillText(L,k,c+u+i.tickLength+2)}}{const{name:x,type:p}=t.file,b=(h=t.getBitrate())!=null?h:0,y=`${x} (${p}, ${g} Hz, ${b/1e3}kbps, ${v} channels)`;e.textAlign="left",e.textBaseline="bottom",e.font="14px monospace",e.fillText(y,r,c-8)}}},X=n=>{const{renderer:e,context:t,config:i}=n,{width:o,height:l}=t.canvas;t.resetTransform();const a=e.getSpectrum();if(a){const[c,d,s,r]=i.visuals.graphMargin;t.drawImage(a,r,c,o-d-r,l-c-s),t.translate(.5,.5)}},fe=async n=>{const{renderer:e,context:t,config:{analyzer:i,audioContextOptions:o}}=n,{width:l,height:a}=t.canvas,{minDecibels:c,maxDecibels:d}=i;await e.startRender({width:l,height:a,minDecibels:c,maxDecibels:d,audioContextOptions:o}),X(n)},de=(n,e)=>{const t=document.createElement("a");document.body.appendChild(t),t.setAttribute("download",e),t.href=URL.createObjectURL(n),t.click(),document.body.removeChild(t)};function he(n){return(e,t,i,o={})=>{e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t];const l=e.map(a=>typeof a=="string"?document.querySelector(a):a);for(const a of l)for(const c of t)a[n](c,i,A({capture:!1},o));return[l,t,i,o]}}const I=he("addEventListener"),ge=(n,e=devicePixelRatio)=>{n.width=0,n.height=0;const t=n.getBoundingClientRect(),i=Math.round(e*t.right)-Math.round(e*t.left),o=Math.round(e*t.bottom)-Math.round(e*t.top);return{width:i,height:o}},me=(n,e=500)=>{let t=0,i=-1;return function(...l){const a=performance.now(),c=a-t;c>=e?(clearTimeout(i),n(...l).then(()=>{t=a,i=-1})):i===-1&&(i=setTimeout(()=>n(...l),c))}},S={analyzer:{minDecibels:-120,maxDecibels:-20},audioContextOptions:{sampleRate:48e3},visuals:{graphMargin:[25,100,35,65],decibelBarWidth:10,tickMinDistance:50,tickThickness:1,tickLength:10}},pe=()=>{var d,s;let n;const e=document.getElementById("canvas"),t=e.getContext("2d",{alpha:!1}),i=me(async()=>{n&&(await fe({renderer:n,context:t,config:S}),o())},500),o=()=>{const{width:r,height:u}=ge(e);e.width=r,e.height=u,ue({renderer:n,context:t,config:S}),n&&X({renderer:n,context:t,config:S}),i()},l=()=>{var r;return(r=document.getElementById("help"))==null?void 0:r.classList.toggle("visible")},a=r=>{if(n!=null&&n.canvas){const u=n.file.name.replace(/\W+/g,"-").replace(/\.[^.]+$/,"");(r?n.canvas:e).toBlob(f=>{f&&de(f,`spectrum-${u}.png`)},"image/png")}},c=r=>{n=void 0,o(),n=new R(r,{width:screen.availWidth,height:screen.availHeight,maxDecibels:S.analyzer.maxDecibels,minDecibels:S.analyzer.minDecibels}),o()};I("#canvas",["dragover","drop"],r=>{var u;if(r.preventDefault(),!!r.dataTransfer&&(r.dataTransfer.dropEffect="copy",r.type==="drop")){const f=(u=r.dataTransfer.files)==null?void 0:u[0];f&&c(f)}}),I(window,"keydown",r=>{var u;if(r.ctrlKey||r.metaKey)switch(r.preventDefault(),r.code){case"KeyS":return a(r.shiftKey);case"ArrowUp":return S.analyzer[r.shiftKey?"minDecibels":"maxDecibels"]+=1,o();case"ArrowDown":return S.analyzer[r.shiftKey?"minDecibels":"maxDecibels"]-=1,o()}else switch(r.code){case"KeyF":return(u=document.getElementById("header"))==null||u.classList.toggle("visible"),o();case"KeyH":return l()}}),I("#file-input","change",r=>{var f;const u=(f=r.target.files)==null?void 0:f[0];u&&c(u)}),window.addEventListener("resize",o),document.addEventListener("fullscreenchange",o),(d=document.getElementById("help-screen-btn"))==null||d.addEventListener("click",l),(s=document.getElementById("help"))==null||s.addEventListener("click",l),o()};console.log(`Build from ${new Date(1653663193863).toLocaleString()}`);var G;!("OfflineAudioContext"in window)||!("suspend"in window.OfflineAudioContext.prototype)?(G=document.getElementById("incompatible"))==null||G.classList.add("visible"):(oe(),pe());
